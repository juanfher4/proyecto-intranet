{% extends "base.html" %}
{% load static %}

{% block title %}Productos{% endblock %}

{% block titulo %}Productos{% endblock %}

{% block content %}
<div class="container-pred productos">
    <div class="row">
        <!-- Filtros -->
        <div class="col-lg-3 col-12">
            <!-- Botón para añadir un producto -->
            <a href="{% url 'productos:crear_producto' %}" class="btn btn-primary mt-3">Añadir producto</a>
            <!-- Filtros -->
            <div class="filtros p-3">
                <h3>Filtros</h3>
                
                <!-- Filtro por Espesor -->
                <h4 class="pt-2 pb-2">Espesor</h4>
                <ul class="list-group pt-1">
                    <a href="{% url 'productos:productos' %}" class="all list-group-item {% if not espesor %}active{% endif %}">Todos</a>
                    {% for esp in espesores %}
                        <a class="list-group-item {% if espesor and espesor.id_espesor == esp.id_espesor %}active{% endif %}" href="{{ esp.get_absolute_url }}">
                            {{ esp.nombre }}{% if esp.revestimiento %} + Rev{% endif %}
                        </a>
                    {% endfor %}
                </ul>

                <!-- Filtro por Habitaciones -->
                <h4 class="pt-2 pb-2">Habitaciones</h4>
                <ul class="list-group pt-1">
                    <a href="{% url 'productos:productos' %}" class="all list-group-item {% if not filtros.num_habitaciones %}active{% endif %}">Todas</a>
                    {% for h in habitaciones %}
                        <a class="list-group-item {% if filtros.num_habitaciones == h|stringformat:"s" %}active{% endif %}"
                        href="?num_habitaciones={{ h }}{% if filtros.num_banios %}&num_banios={{ filtros.num_banios }}{% endif %}{% if filtros.num_plantas %}&num_plantas={{ filtros.num_plantas }}{% endif %}{% if filtros.num_cocina %}&num_cocina={{ filtros.num_cocina }}{% endif %}{% if filtros.tipo_productos %}&tipo_productos={{ filtros.tipo_productos }}{% endif %}">
                            {{ h }}
                        </a>
                    {% endfor %}
                </ul>

                <!-- Filtro por Baños -->
                <h4 class="pt-2 pb-2">Baños</h4>
                <ul class="list-group pt-1">
                    <a href="{% url 'productos:productos' %}" class="all list-group-item {% if not filtros.num_banios %}active{% endif %}">Todos</a>
                    {% for b in banios %}
                        <a class="list-group-item {% if filtros.num_banios == b|stringformat:"s" %}active{% endif %}"
                        href="?num_banios={{ b }}{% if filtros.num_habitaciones %}&num_habitaciones={{ filtros.num_habitaciones }}{% endif %}{% if filtros.num_plantas %}&num_plantas={{ filtros.num_plantas }}{% endif %}{% if filtros.num_cocina %}&num_cocina={{ filtros.num_cocina }}{% endif %}{% if filtros.tipo_productos %}&tipo_productos={{ filtros.tipo_productos }}{% endif %}">
                            {{ b }}
                        </a>
                    {% endfor %}
                </ul>

                <!-- Filtro por Plantas -->
                <h4 class="pt-2 pb-2">Plantas</h4>
                <ul class="list-group pt-1">
                    <a href="{% url 'productos:productos' %}" class="all list-group-item {% if not filtros.num_plantas %}active{% endif %}">Todas</a>
                    {% for p in plantas %}
                        <a class="list-group-item {% if filtros.num_plantas == p|stringformat:"s" %}active{% endif %}"
                        href="?num_plantas={{ p }}{% if filtros.num_habitaciones %}&num_habitaciones={{ filtros.num_habitaciones }}{% endif %}{% if filtros.num_banios %}&num_banios={{ filtros.num_banios }}{% endif %}{% if filtros.num_cocina %}&num_cocina={{ filtros.num_cocina }}{% endif %}{% if filtros.tipo_productos %}&tipo_productos={{ filtros.tipo_productos }}{% endif %}">
                            {{ p }}
                        </a>
                    {% endfor %}
                </ul>

                <!-- Filtro por Cocinas -->
                <h4 class="pt-2 pb-2">Cocinas</h4>
                <ul class="list-group pt-1">
                    <a href="{% url 'productos:productos' %}" class="all list-group-item {% if not filtros.num_cocina %}active{% endif %}">Todas</a>
                    {% for c in cocinas %}
                        <a class="list-group-item {% if filtros.num_cocina == c|stringformat:"s" %}active{% endif %}"
                        href="?num_cocina={{ c }}{% if filtros.num_habitaciones %}&num_habitaciones={{ filtros.num_habitaciones }}{% endif %}{% if filtros.num_banios %}&num_banios={{ filtros.num_banios }}{% endif %}{% if filtros.num_plantas %}&num_plantas={{ filtros.num_plantas }}{% endif %}{% if filtros.tipo_productos %}&tipo_productos={{ filtros.tipo_productos }}{% endif %}">
                            {{ c }}
                        </a>
                    {% endfor %}
                </ul>

                <!-- Filtro por Tipo de Producto -->
                <h4 class="pt-2 pb-2">Tipo de producto</h4>
                <ul class="list-group pt-1">
                    <a href="{% url 'productos:productos' %}" class="all list-group-item {% if not filtros.tipo_productos %}active{% endif %}">Todos</a>
                    {% for tipo in tipos %}
                        <a class="list-group-item {% if filtros.tipo_productos == tipo.slug %}active{% endif %}"
                        href="?tipo_productos={{ tipo.slug }}{% if filtros.num_habitaciones %}&num_habitaciones={{ filtros.num_habitaciones }}{% endif %}{% if filtros.num_banios %}&num_banios={{ filtros.num_banios }}{% endif %}{% if filtros.num_plantas %}&num_plantas={{ filtros.num_plantas }}{% endif %}{% if filtros.num_cocina %}&num_cocina={{ filtros.num_cocina }}{% endif %}">
                            {{ tipo.nombre }}
                        </a>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <div class="col-lg-9 p-3">
            <!-- Navegación vista -->
            <!-- Vista cartas -->
            <div class="row text-center vista-cartas align-items-stretch">
                {% for producto in productos %}
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12 p-1 d-flex">
                        <a href="{% url 'productos:edit_producto' producto.id_producto %}" class="flex-fill text-decoration-none text-dark">
                            <div class="card h-100">
                                <img src="{% if producto.imagen %}{{ producto.imagen.url }}{% else %}{% static 'img/casa.jpg' %}{% endif %}" class="card-img-top" alt="{{ producto.nombre }}">
                                <div class="card-text p-2">
                                    <h5 class="card-title p-2">{{ producto.nombre }}</h5>
                                    <i>
                                        {% for precio_espesor in producto.precios_espesor.all %}
                                            <li>
                                                {{ precio_espesor.espesor.nombre }}{% if precio_espesor.espesor.revestimiento %} (rev){% endif %}: 
                                                {{ precio_espesor.precio }} €
                                            </li>
                                        {% endfor %}
                                    </i>
                                    <p class="card-text p-1">
                                        <strong>Tipo: </strong>
                                        {% for tipo in producto.tipo_productos.all %}
                                            {{ tipo.nombre }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </p>
                                    <p class="card-text p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="18" height="18" class="icono ms-1">
                                            <path d="m19,11H2V3c0-.552-.448-1-1-1s-1,.448-1,1v18c0,.552.448,1,1,1s1-.448,1-1v-2h20v2c0,.552.447,1,1,1s1-.448,1-1v-5c0-2.757-2.243-5-5-5ZM2,17v-4h17c1.654,0,3,1.346,3,3v1H2Z"/>
                                        </svg>                                          
                                        {{ producto.num_habitaciones }}
                                        <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="18" height="18" class="icono ms-1">
                                            <path d="m23.249,13.015c-.569-.645-1.389-1.015-2.249-1.015H2v-7.518c0-.841.38-1.673,1.093-2.12,1.089-.683,2.419-.347,3.107.571l.259.345-.483,2.771c-.058.334.011.678.194.963.425.662,1.323.824,1.952.352l3.606-2.704c.567-.425.71-1.217.327-1.814l-.013-.021c-.237-.37-.64-.602-1.079-.622l-2.906-.129-.174-.232c-.658-.877-1.593-1.542-2.669-1.755C2.44-.462,0,1.656,0,4.333c0,0,.004,5.71.006,7.923,0,.576.037,1.145.108,1.717.101.809.237,1.9.237,1.9.251,2.005,1.223,3.767,2.635,5.037l-.457,1.85c-.133.536.194,1.078.73,1.211.081.02.161.029.241.029.449,0,.857-.305.97-.76l.277-1.121c1.109.564,2.36.881,3.676.881h7.417c1.223,0,2.39-.273,3.44-.765l.249,1.005c.112.455.521.76.97.76.08,0,.16-.01.241-.029.536-.133.863-.675.73-1.211l-.41-1.66c1.53-1.282,2.591-3.12,2.854-5.226l.062-.501c.106-.854-.158-1.712-.728-2.357Zm-1.257,2.109l-.062.501c-.383,3.064-3.001,5.375-6.089,5.375h-7.417c-3.088,0-5.705-2.311-6.088-5.375l-.203-1.625h18.867c.291,0,.558.12.75.338.192.219.278.497.242.786Z"/>
                                        </svg>
                                        {{ producto.num_banios }}
                                        <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="18" height="18" class="icono ms-1">
                                            <path d="m19,0H5c-1.654,0-3,1.346-3,3v21h20V3c0-1.654-1.346-3-3-3ZM5,2h14c.552,0,1,.449,1,1v5H4V3c0-.551.449-1,1-1Zm-1,20v-12h16v12H4Zm2-2h12v-8H6v8Zm2-6h8v4h-8v-4Zm2.5-9c0-.828.672-1.5,1.5-1.5s1.5.672,1.5,1.5-.672,1.5-1.5,1.5-1.5-.672-1.5-1.5Zm4.5,0c0-.828.672-1.5,1.5-1.5s1.5.672,1.5,1.5-.672,1.5-1.5,1.5-1.5-.672-1.5-1.5Zm-9,0c0-.828.672-1.5,1.5-1.5s1.5.672,1.5,1.5-.672,1.5-1.5,1.5-1.5-.672-1.5-1.5Z"/>
                                        </svg>
                                        {{ producto.num_cocina }}
                                        <svg id="Layer_1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1" width="18" height="18" class="icono ms-1">
                                            <path d="m20 11.356v-3.356h-5v3h-1v-4h7v5.037l-.398-.311c-.189-.148-.393-.266-.602-.369zm4 6.507v6.137h-11v-6.137c0-.597.27-1.15.74-1.519l3.892-3.045c.511-.4 1.226-.4 1.736 0l3.892 3.045c.471.368.74.921.74 1.519zm-1 0c0-.288-.13-.554-.356-.731l-3.892-3.045c-.148-.116-.355-.116-.504 0l-3.892 3.045c-.227.178-.356.444-.356.731v5.137h9zm1-13.863v10.384l-1-.782v-8.602h-17v14h-3c-1.103 0-2 .897-2 2s.897 2 2 2h8v1h-8c-1.654 0-3-1.346-3-3v-18c0-1.654 1.346-3 3-3h3v4zm-19-3h-2c-1.103 0-2 .897-2 2v15.766c.531-.476 1.232-.766 2-.766h2zm12 17h3v3h-3zm1 2h1v-1h-1zm-10 1h3v-1h-2v-8h2v-1h-2v-3h2v-1h-3z"/>
                                        </svg>
                                        {{ producto.num_plantas }}
                                    </p>
                                </div>
                            </div>
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
